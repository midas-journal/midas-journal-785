INCLUDE(${CMAKE_SOURCE_DIR}/IJMacros.txt)

PROJECT( MPIITK )

cmake_minimum_required( VERSION 2.8 )

ENABLE_TESTING()
INCLUDE(Dart)

SET(Required_Packages
ITK
)

FOREACH(Package ${Required_Packages})
  LOADPACKAGE(${Package})
ENDFOREACH(Package)

INCLUDE( FindMPI )
INCLUDE_DIRECTORIES( ${MPI_INCLUDE_PATH} )

SET( ITK_LIBS ${ITK_LIBS} ITKCommon )
SET( ITK_LIBS ${ITK_LIBS} ITKIO )

SET( MPI_LIBS ${MPI_LIBS} "${MPI_LIBRARY}" )
SET( MPI_LIBS ${MPI_LIBS} "${MPI_EXTRA_LIBRARY}" )

ADD_EXECUTABLE( MPIReadWrite MPIReadWrite.cxx )
TARGET_LINK_LIBRARIES ( MPIReadWrite ${ITK_LIBS} ${MPI_LIBS} )

ADD_TEST(TestMPIReadWrite ${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} 
  ${MPIEXEC_MAX_NUMPROCS} ${MPIEXEC_PREFLAGS}
  ./MPIReadWrite ${MPIEXEC_POSTFLAGS}
  ${CMAKE_SOURCE_DIR}/VisibleWomanEye.mhd
  VisibleWomanEyeMPI.mhd )

ADD_TEST(TestCompare ImageCompare VisibleWomanEyeMPI.mhd 
  ${CMAKE_SOURCE_DIR}/VisibleWomanEye.mhd )


